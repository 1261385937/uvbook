<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Basics of libuv &mdash; An Introduction to libuv</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="An Introduction to libuv" href="index.html" />
    <link rel="next" title="Filesystem" href="filesystem.html" />
    <link rel="prev" title="Introduction" href="introduction.html" />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33699076-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>An Introduction to libuv</span></a></h1>
        <h2 class="heading"><span>Basics of libuv</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="introduction.html">Introduction</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="filesystem.html">Filesystem</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="basics-of-libuv">
<h1>Basics of libuv<a class="headerlink" href="#basics-of-libuv" title="Permalink to this headline">¶</a></h1>
<p>libuv enforces an <strong>asynchronous</strong>, <strong>event-driven</strong> style of programming.  Its
core job is to provide an event loop and callback based notifications of I/O
and other activities.  libuv offers core utilities like timers, non-blocking
networking support, asynchronous file system access, child processes and more.</p>
<div class="section" id="event-loops">
<h2>Event loops<a class="headerlink" href="#event-loops" title="Permalink to this headline">¶</a></h2>
<p>In event-driven programming, an application expresses interest in certain events
and respond to them when they occur. The responsibility of gathering events
from the operating system or monitoring other sources of events is handled by
libuv, and the user can register callbacks to be invoked when an event occurs.
The event-loop usually keeps running <em>forever</em>. In pseudocode:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">while</span> <span class="n">there</span> <span class="n">are</span> <span class="n">still</span> <span class="n">events</span> <span class="n">to</span> <span class="n">process</span><span class="p">:</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">get</span> <span class="n">the</span> <span class="nb">next</span> <span class="n">event</span>
    <span class="k">if</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">callback</span> <span class="n">associated</span> <span class="k">with</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">call</span> <span class="n">the</span> <span class="n">callback</span>
</pre></div>
</div>
<p>Some examples of events are:</p>
<ul class="simple">
<li>File is ready for writing</li>
<li>A socket has data ready to be read</li>
<li>A timer has timed out</li>
</ul>
<p>This event loop is encapsulated by <tt class="docutils literal"><span class="pre">uv_run()</span></tt> &#8211; the end-all function when using
libuv.</p>
<p>The most common activity of systems programs is to deal with input and output,
rather than a lot of number-crunching. The problem with using conventional
input/output functions (<tt class="docutils literal"><span class="pre">read</span></tt>, <tt class="docutils literal"><span class="pre">fprintf</span></tt>, etc.) is that they are
<strong>blocking</strong>. The actual write to a hard disk or reading from a network, takes
a disproportionately long time compared to the speed of the processor. The
functions don&#8217;t return until the task is done, so that your program is doing
nothing. For programs which require high performance this is a major roadblock
as other activities and other I/O operations are kept waiting.</p>
<p>One of the standard solutions is to use threads. Each blocking I/O operation is
started in a separate thread (or in a thread pool). When the blocking function
gets invoked in the thread, the processor can schedule another thread to run,
which actually needs the CPU.</p>
<p>The approach followed by libuv uses another style, which is the <strong>asynchronous,
non-blocking</strong> style. Most modern operating systems provide event notification
subsystems. For example, a normal <tt class="docutils literal"><span class="pre">read</span></tt> call on a socket would block until
the sender actually sent something. Instead, the application can request the
operating system to watch the socket and put an event notification in the
queue. The application can inspect the events at its convenience (perhaps doing
some number crunching before to use the processor to the maximum) and grab the
data. It is <strong>asynchronous</strong> because the application expressed interest at one
point, then used the data at another point (in time and space). It is
<strong>non-blocking</strong> because the application process was free to do other tasks.
This fits in well with libuv&#8217;s event-loop approach, since the operating system
events can be treated as just another libuv event. The non-blocking ensures
that other events can continue to be handled as fast they come in <a class="footnote-reference" href="#id2" id="id1">[1]</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">How the I/O is run in the background is not of our concern, but due to the
way our computer hardware works, with the thread as the basic unit of the
processor, libuv and OSes will usually run background/worker threads and/or
polling to perform tasks in a non-blocking manner.</p>
</div>
<p>Bert Belder, one of the libuv core developers has a small video explaining the
architecture of libuv and its background. If you have no prior experience with
either libuv or libev, it is a quick, useful watch.</p>
<iframe width="560" height="315"
src="https://www.youtube-nocookie.com/embed/nGn60vDSxQ4" frameborder="0"
allowfullscreen></iframe></div>
<div class="section" id="hello-world">
<h2>Hello World<a class="headerlink" href="#hello-world" title="Permalink to this headline">¶</a></h2>
<p>With the basics out of the way, lets write our first libuv program. It does
nothing, except start a loop which will exit immediately.</p>
<p class="rubric">helloworld/main.c</p>
<div class="highlight-c"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">#include &lt;stdio.h&gt;</span>
<span class="cp">#include &lt;uv.h&gt;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">uv_loop_t</span> <span class="o">*</span><span class="n">loop</span> <span class="o">=</span> <span class="n">uv_loop_new</span><span class="p">();</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Now quitting.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">uv_run</span><span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="n">UV_RUN_DEFAULT</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>This program quits immediately because it has no events to process. A libuv
event loop has to be told to watch out for events using the various API
functions.</p>
<div class="section" id="default-loop">
<h3>Default loop<a class="headerlink" href="#default-loop" title="Permalink to this headline">¶</a></h3>
<p>A default loop is provided by libuv and can be accessed using
<tt class="docutils literal"><span class="pre">uv_default_loop()</span></tt>. You should use this loop if you only want a single
loop.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">node.js uses the default loop as its main loop. If you are writing bindings
you should be aware of this.</p>
</div>
</div>
</div>
<div class="section" id="error-handling">
<h2>Error handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h2>
<p>libuv functions which may fail return <tt class="docutils literal"><span class="pre">-1</span></tt> on error. The error code itself is
set on the event loop as <tt class="docutils literal"><span class="pre">last_err</span></tt>. Use <tt class="docutils literal"><span class="pre">uv_last_error(loop)</span></tt> to get
a <tt class="docutils literal"><span class="pre">uv_err_t</span></tt> which has a <tt class="docutils literal"><span class="pre">code</span></tt> member with the error code. <tt class="docutils literal"><span class="pre">code</span></tt> is an
enumeration of <tt class="docutils literal"><span class="pre">UV_*</span></tt> as defined here:</p>
<p class="rubric">libuv error codes</p>
<div class="highlight-c"><div class="highlight"><pre>  <span class="n">XX</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">UNKNOWN</span><span class="p">,</span> <span class="s">&quot;unknown error&quot;</span><span class="p">)</span>                                           \
  <span class="n">XX</span><span class="p">(</span>  <span class="mi">0</span><span class="p">,</span> <span class="n">OK</span><span class="p">,</span> <span class="s">&quot;success&quot;</span><span class="p">)</span>                                                      \
  <span class="n">XX</span><span class="p">(</span>  <span class="mi">1</span><span class="p">,</span> <span class="n">EOF</span><span class="p">,</span> <span class="s">&quot;end of file&quot;</span><span class="p">)</span>                                                 \
  <span class="n">XX</span><span class="p">(</span>  <span class="mi">2</span><span class="p">,</span> <span class="n">EADDRINFO</span><span class="p">,</span> <span class="s">&quot;getaddrinfo error&quot;</span><span class="p">)</span>                                     \
  <span class="n">XX</span><span class="p">(</span>  <span class="mi">3</span><span class="p">,</span> <span class="n">EACCES</span><span class="p">,</span> <span class="s">&quot;permission denied&quot;</span><span class="p">)</span>                                        \
  <span class="n">XX</span><span class="p">(</span>  <span class="mi">4</span><span class="p">,</span> <span class="n">EAGAIN</span><span class="p">,</span> <span class="s">&quot;resource temporarily unavailable&quot;</span><span class="p">)</span>                         \
  <span class="n">XX</span><span class="p">(</span>  <span class="mi">5</span><span class="p">,</span> <span class="n">EADDRINUSE</span><span class="p">,</span> <span class="s">&quot;address already in use&quot;</span><span class="p">)</span>                               \
  <span class="n">XX</span><span class="p">(</span>  <span class="mi">6</span><span class="p">,</span> <span class="n">EADDRNOTAVAIL</span><span class="p">,</span> <span class="s">&quot;address not available&quot;</span><span class="p">)</span>                             \
  <span class="n">XX</span><span class="p">(</span>  <span class="mi">7</span><span class="p">,</span> <span class="n">EAFNOSUPPORT</span><span class="p">,</span> <span class="s">&quot;address family not supported&quot;</span><span class="p">)</span>                       \
  <span class="n">XX</span><span class="p">(</span>  <span class="mi">8</span><span class="p">,</span> <span class="n">EALREADY</span><span class="p">,</span> <span class="s">&quot;connection already in progress&quot;</span><span class="p">)</span>                         \
  <span class="n">XX</span><span class="p">(</span>  <span class="mi">9</span><span class="p">,</span> <span class="n">EBADF</span><span class="p">,</span> <span class="s">&quot;bad file descriptor&quot;</span><span class="p">)</span>                                       \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">10</span><span class="p">,</span> <span class="n">EBUSY</span><span class="p">,</span> <span class="s">&quot;resource busy or locked&quot;</span><span class="p">)</span>                                   \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">11</span><span class="p">,</span> <span class="n">ECONNABORTED</span><span class="p">,</span> <span class="s">&quot;software caused connection abort&quot;</span><span class="p">)</span>                   \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">12</span><span class="p">,</span> <span class="n">ECONNREFUSED</span><span class="p">,</span> <span class="s">&quot;connection refused&quot;</span><span class="p">)</span>                                 \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">13</span><span class="p">,</span> <span class="n">ECONNRESET</span><span class="p">,</span> <span class="s">&quot;connection reset by peer&quot;</span><span class="p">)</span>                             \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">14</span><span class="p">,</span> <span class="n">EDESTADDRREQ</span><span class="p">,</span> <span class="s">&quot;destination address required&quot;</span><span class="p">)</span>                       \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">15</span><span class="p">,</span> <span class="n">EFAULT</span><span class="p">,</span> <span class="s">&quot;bad address in system call argument&quot;</span><span class="p">)</span>                      \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">16</span><span class="p">,</span> <span class="n">EHOSTUNREACH</span><span class="p">,</span> <span class="s">&quot;host is unreachable&quot;</span><span class="p">)</span>                                \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">17</span><span class="p">,</span> <span class="n">EINTR</span><span class="p">,</span> <span class="s">&quot;interrupted system call&quot;</span><span class="p">)</span>                                   \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">18</span><span class="p">,</span> <span class="n">EINVAL</span><span class="p">,</span> <span class="s">&quot;invalid argument&quot;</span><span class="p">)</span>                                         \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">19</span><span class="p">,</span> <span class="n">EISCONN</span><span class="p">,</span> <span class="s">&quot;socket is already connected&quot;</span><span class="p">)</span>                             \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">20</span><span class="p">,</span> <span class="n">EMFILE</span><span class="p">,</span> <span class="s">&quot;too many open files&quot;</span><span class="p">)</span>                                      \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">21</span><span class="p">,</span> <span class="n">EMSGSIZE</span><span class="p">,</span> <span class="s">&quot;message too long&quot;</span><span class="p">)</span>                                       \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">22</span><span class="p">,</span> <span class="n">ENETDOWN</span><span class="p">,</span> <span class="s">&quot;network is down&quot;</span><span class="p">)</span>                                        \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">23</span><span class="p">,</span> <span class="n">ENETUNREACH</span><span class="p">,</span> <span class="s">&quot;network is unreachable&quot;</span><span class="p">)</span>                              \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">24</span><span class="p">,</span> <span class="n">ENFILE</span><span class="p">,</span> <span class="s">&quot;file table overflow&quot;</span><span class="p">)</span>                                      \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">25</span><span class="p">,</span> <span class="n">ENOBUFS</span><span class="p">,</span> <span class="s">&quot;no buffer space available&quot;</span><span class="p">)</span>                               \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">26</span><span class="p">,</span> <span class="n">ENOMEM</span><span class="p">,</span> <span class="s">&quot;not enough memory&quot;</span><span class="p">)</span>                                        \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">27</span><span class="p">,</span> <span class="n">ENOTDIR</span><span class="p">,</span> <span class="s">&quot;not a directory&quot;</span><span class="p">)</span>                                         \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">28</span><span class="p">,</span> <span class="n">EISDIR</span><span class="p">,</span> <span class="s">&quot;illegal operation on a directory&quot;</span><span class="p">)</span>                         \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">29</span><span class="p">,</span> <span class="n">ENONET</span><span class="p">,</span> <span class="s">&quot;machine is not on the network&quot;</span><span class="p">)</span>                            \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">31</span><span class="p">,</span> <span class="n">ENOTCONN</span><span class="p">,</span> <span class="s">&quot;socket is not connected&quot;</span><span class="p">)</span>                                \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">32</span><span class="p">,</span> <span class="n">ENOTSOCK</span><span class="p">,</span> <span class="s">&quot;socket operation on non-socket&quot;</span><span class="p">)</span>                         \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">33</span><span class="p">,</span> <span class="n">ENOTSUP</span><span class="p">,</span> <span class="s">&quot;operation not supported on socket&quot;</span><span class="p">)</span>                       \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">34</span><span class="p">,</span> <span class="n">ENOENT</span><span class="p">,</span> <span class="s">&quot;no such file or directory&quot;</span><span class="p">)</span>                                \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">35</span><span class="p">,</span> <span class="n">ENOSYS</span><span class="p">,</span> <span class="s">&quot;function not implemented&quot;</span><span class="p">)</span>                                 \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">36</span><span class="p">,</span> <span class="n">EPIPE</span><span class="p">,</span> <span class="s">&quot;broken pipe&quot;</span><span class="p">)</span>                                               \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">37</span><span class="p">,</span> <span class="n">EPROTO</span><span class="p">,</span> <span class="s">&quot;protocol error&quot;</span><span class="p">)</span>                                           \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">38</span><span class="p">,</span> <span class="n">EPROTONOSUPPORT</span><span class="p">,</span> <span class="s">&quot;protocol not supported&quot;</span><span class="p">)</span>                          \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">39</span><span class="p">,</span> <span class="n">EPROTOTYPE</span><span class="p">,</span> <span class="s">&quot;protocol wrong type for socket&quot;</span><span class="p">)</span>                       \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">40</span><span class="p">,</span> <span class="n">ETIMEDOUT</span><span class="p">,</span> <span class="s">&quot;connection timed out&quot;</span><span class="p">)</span>                                  \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">41</span><span class="p">,</span> <span class="n">ECHARSET</span><span class="p">,</span> <span class="s">&quot;invalid Unicode character&quot;</span><span class="p">)</span>                              \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">42</span><span class="p">,</span> <span class="n">EAIFAMNOSUPPORT</span><span class="p">,</span> <span class="s">&quot;address family for hostname not supported&quot;</span><span class="p">)</span>       \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">44</span><span class="p">,</span> <span class="n">EAISERVICE</span><span class="p">,</span> <span class="s">&quot;servname not supported for ai_socktype&quot;</span><span class="p">)</span>               \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">45</span><span class="p">,</span> <span class="n">EAISOCKTYPE</span><span class="p">,</span> <span class="s">&quot;ai_socktype not supported&quot;</span><span class="p">)</span>                           \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">46</span><span class="p">,</span> <span class="n">ESHUTDOWN</span><span class="p">,</span> <span class="s">&quot;cannot send after transport endpoint shutdown&quot;</span><span class="p">)</span>         \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">47</span><span class="p">,</span> <span class="n">EEXIST</span><span class="p">,</span> <span class="s">&quot;file already exists&quot;</span><span class="p">)</span>                                      \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">48</span><span class="p">,</span> <span class="n">ESRCH</span><span class="p">,</span> <span class="s">&quot;no such process&quot;</span><span class="p">)</span>                                           \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">49</span><span class="p">,</span> <span class="n">ENAMETOOLONG</span><span class="p">,</span> <span class="s">&quot;name too long&quot;</span><span class="p">)</span>                                      \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">50</span><span class="p">,</span> <span class="n">EPERM</span><span class="p">,</span> <span class="s">&quot;operation not permitted&quot;</span><span class="p">)</span>                                   \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">51</span><span class="p">,</span> <span class="n">ELOOP</span><span class="p">,</span> <span class="s">&quot;too many symbolic links encountered&quot;</span><span class="p">)</span>                       \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">52</span><span class="p">,</span> <span class="n">EXDEV</span><span class="p">,</span> <span class="s">&quot;cross-device link not permitted&quot;</span><span class="p">)</span>                           \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">53</span><span class="p">,</span> <span class="n">ENOTEMPTY</span><span class="p">,</span> <span class="s">&quot;directory not empty&quot;</span><span class="p">)</span>                                   \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">54</span><span class="p">,</span> <span class="n">ENOSPC</span><span class="p">,</span> <span class="s">&quot;no space left on device&quot;</span><span class="p">)</span>                                  \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">55</span><span class="p">,</span> <span class="n">EIO</span><span class="p">,</span> <span class="s">&quot;i/o error&quot;</span><span class="p">)</span>                                                   \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">56</span><span class="p">,</span> <span class="n">EROFS</span><span class="p">,</span> <span class="s">&quot;read-only file system&quot;</span><span class="p">)</span>                                     \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">57</span><span class="p">,</span> <span class="n">ENODEV</span><span class="p">,</span> <span class="s">&quot;no such device&quot;</span><span class="p">)</span>                                           \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">58</span><span class="p">,</span> <span class="n">ESPIPE</span><span class="p">,</span> <span class="s">&quot;invalid seek&quot;</span><span class="p">)</span>                                             \
  <span class="n">XX</span><span class="p">(</span> <span class="mi">59</span><span class="p">,</span> <span class="n">ECANCELED</span><span class="p">,</span> <span class="s">&quot;operation canceled&quot;</span><span class="p">)</span>                                    \
</pre></div>
</div>
<p>You can use the <tt class="docutils literal"><span class="pre">uv_strerror(uv_err_t)</span></tt> and <tt class="docutils literal"><span class="pre">uv_err_name(uv_err_t)</span></tt> functions
to get a <tt class="docutils literal"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*</span></tt> describing the error or the error name respectively.</p>
<p>Async callbacks have a <tt class="docutils literal"><span class="pre">status</span></tt> argument as the last argument. Use this instead
of the return value.</p>
</div>
<div class="section" id="watchers">
<h2>Watchers<a class="headerlink" href="#watchers" title="Permalink to this headline">¶</a></h2>
<p>Watchers are how users of libuv express interest in particular events. Watchers
are opaque structs named as <tt class="docutils literal"><span class="pre">uv_TYPE_t</span></tt> where type signifies what the watcher
is used for. A full list of watchers supported by libuv is:</p>
<p class="rubric">libuv watchers</p>
<div class="highlight-c"><div class="highlight"><pre><span class="k">typedef</span> <span class="k">struct</span> <span class="n">uv_udp_s</span> <span class="kt">uv_udp_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">uv_pipe_s</span> <span class="kt">uv_pipe_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">uv_tty_s</span> <span class="kt">uv_tty_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">uv_poll_s</span> <span class="kt">uv_poll_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">uv_timer_s</span> <span class="kt">uv_timer_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">uv_prepare_s</span> <span class="kt">uv_prepare_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">uv_check_s</span> <span class="kt">uv_check_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">uv_idle_s</span> <span class="kt">uv_idle_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">uv_async_s</span> <span class="kt">uv_async_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">uv_process_s</span> <span class="kt">uv_process_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">uv_fs_event_s</span> <span class="kt">uv_fs_event_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">uv_fs_poll_s</span> <span class="kt">uv_fs_poll_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">uv_signal_s</span> <span class="kt">uv_signal_t</span><span class="p">;</span>

<span class="cm">/* Request types. */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">uv_req_s</span> <span class="kt">uv_req_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">uv_getaddrinfo_s</span> <span class="kt">uv_getaddrinfo_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">uv_shutdown_s</span> <span class="kt">uv_shutdown_t</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All watcher structs are subclasses of <tt class="docutils literal"><span class="pre">uv_handle_t</span></tt> and often referred to
as <strong>handles</strong> in libuv and in this text.</p>
</div>
<p>Watchers are setup by a corresponding:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">uv_TYPE_init</span><span class="p">(</span><span class="n">uv_TYPE_t</span><span class="o">*</span><span class="p">)</span>
</pre></div>
</div>
<p>function.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Some watcher initialization functions require the loop as a first argument.</p>
</div>
<p>A watcher is set to actually listen for events by invoking:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">uv_TYPE_start</span><span class="p">(</span><span class="n">uv_TYPE_t</span><span class="o">*</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
</pre></div>
</div>
<p>and stopped by calling the corresponding:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">uv_TYPE_stop</span><span class="p">(</span><span class="n">uv_TYPE_t</span><span class="o">*</span><span class="p">)</span>
</pre></div>
</div>
<p>Callbacks are functions which are called by libuv whenever an event the watcher
is interested in has taken place. Application specific logic will usually be
implemented in the callback. For example, an IO watcher&#8217;s callback will receive
the data read from a file, a timer callback will be triggered on timeout and so
on.</p>
<div class="section" id="idling">
<h3>Idling<a class="headerlink" href="#idling" title="Permalink to this headline">¶</a></h3>
<p>Here is an example of using a watcher. An idle watcher&#8217;s callback is repeatedly
called. There are some deeper semantics, discussed in <a class="reference internal" href="utilities.html"><em>Utilities</em></a>, but
we&#8217;ll ignore them for now. Let&#8217;s just use an idle watcher to look at the
watcher life cycle and see how <tt class="docutils literal"><span class="pre">uv_run()</span></tt> will now block because a watcher is
present. The idle watcher is stopped when the count is reached and <tt class="docutils literal"><span class="pre">uv_run()</span></tt>
exits since no event watchers are active.</p>
<p class="rubric">idle-basic/main.c</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#include &lt;stdio.h&gt;</span>
<span class="cp">#include &lt;uv.h&gt;</span>

<span class="kt">int64_t</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="hll"><span class="kt">void</span> <span class="nf">wait_for_a_while</span><span class="p">(</span><span class="kt">uv_idle_t</span><span class="o">*</span> <span class="n">handle</span><span class="p">,</span> <span class="kt">int</span> <span class="n">status</span><span class="p">)</span> <span class="p">{</span>
</span>    <span class="n">counter</span><span class="o">++</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&gt;=</span> <span class="mf">10e6</span><span class="p">)</span>
<span class="hll">        <span class="n">uv_idle_stop</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
</span><span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="hll">    <span class="kt">uv_idle_t</span> <span class="n">idler</span><span class="p">;</span>
</span><span class="hll">
</span><span class="hll">    <span class="n">uv_idle_init</span><span class="p">(</span><span class="n">uv_default_loop</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">idler</span><span class="p">);</span>
</span><span class="hll">    <span class="n">uv_idle_start</span><span class="p">(</span><span class="o">&amp;</span><span class="n">idler</span><span class="p">,</span> <span class="n">wait_for_a_while</span><span class="p">);</span>
</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Idling...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">uv_run</span><span class="p">(</span><span class="n">uv_default_loop</span><span class="p">(),</span> <span class="n">UV_RUN_DEFAULT</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>void *data pattern</p>
<p>note about not necessarily creating type structs on the stack</p>
<hr class="docutils" />
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Depending on the capacity of the hardware of course.</td></tr>
</tbody>
</table>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="introduction.html">Introduction</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="filesystem.html">Filesystem</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012-2014, Nikhil Marathe.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>